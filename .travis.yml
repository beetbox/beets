dist: xenial
language: python

matrix:
    include:
        - python: 2.7
          env: TOXENV=py27-test COVERAGE=1
        - python: 2.7
          env: TOXENV=py27-flake8 COVERAGE=1
        - python: 3.7
          env: TOXENV=py37-test COVERAGE=1
        - python: 3.7
          env: TOXENV=py37-flak8 COVERAGE=1
        - python: 2.7
          env: TOXENV=docs


before_install:
    - echo "deb http://archive.ubuntu.com/ubuntu/ trusty multiverse" | sudo tee -a /etc/apt/sources.list
    - echo "deb http://archive.ubuntu.com/ubuntu/ trusty-updates multiverse" | sudo tee -a /etc/apt/sources.list
    - sudo apt-get update
    - sudo apt-get -y install --no-recommends bash-completion girl2 gir1.2-gst-plugins-base-1.0 gir1.2-gstreamer-1.0 gstreamer1.0-plugins-good gstreamer1.0-plugins-bad imagemagick python-gi python-gst-1.0 python3-gi python3-gst-1.0 unrar

install: pip install --user tox sphinx codecov

script: tox

# Report coverage to codecov.io.
after_success:
    - "[ ! -z $COVERAGE ] && codecov || true"

cache:
    pip: true

notifications:
    irc:
        channels:
            - "irc.freenode.org#beets"
        use_notice: true
        skip_join: true
        on_success: change
        on_failure: always
